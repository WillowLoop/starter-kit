name: Deploy Frontend

on:
  # STAP 1: Verwijder dit commentaar en uncomment de triggers hieronder
  # nadat je VERCEL_TOKEN, VERCEL_ORG_ID en VERCEL_PROJECT_ID hebt ingesteld.
  # Zie docs/workflows/cicd-setup.md voor instructies.
  #
  # pull_request:
  #   branches: [main]
  #   paths: ['frontend/**', '.github/workflows/deploy-frontend.yml']
  # push:
  #   branches: [main]
  #   paths: ['frontend/**']
  workflow_dispatch:  # handmatig triggeren voor test-deploy

permissions:
  contents: read
  pull-requests: write

jobs:
  deploy:
    runs-on: ubuntu-latest
    environment:
      name: ${{ github.event_name == 'push' && 'production' || 'preview' }}
      url: ${{ steps.deploy.outputs.url }}
    defaults:
      run:
        working-directory: frontend
    steps:
      - uses: actions/checkout@34e114876b0b11c390a56381ad16ebd13914f8d5 # v4.3.1
      - uses: pnpm/action-setup@41ff72655975bd51cab0327fa583b6e92b6d3061 # v4.2.0
        with:
          version: 10
      - uses: actions/setup-node@49933ea5288caeca8642d1e84afbd3f7d6820020 # v4.4.0
        with:
          node-version: 22
          cache: pnpm
          cache-dependency-path: frontend/pnpm-lock.yaml
      - run: pnpm install --frozen-lockfile
      - run: pnpm build
      - id: deploy
        uses: amondnet/vercel-action@34c3c2b72f4e1d10b4b4c18d5f2e8d3c8e7f5e5a # v20
        with:
          vercel-token: ${{ secrets.VERCEL_TOKEN }}
          vercel-org-id: ${{ secrets.VERCEL_ORG_ID }}
          vercel-project-id: ${{ secrets.VERCEL_PROJECT_ID }}
          working-directory: ./frontend
          vercel-args: ${{ github.event_name == 'push' && '--prod' || '' }}
      - name: Post preview URL
        if: github.event_name == 'pull_request'
        uses: actions/github-script@60a0d83039c74a4aee543508d2ffcb1c3799cdea # v7.0.1
        with:
          script: |
            github.rest.issues.createComment({
              ...context.repo,
              issue_number: context.issue.number,
              body: `ðŸš€ Preview: ${{ steps.deploy.outputs.url }}`
            })
